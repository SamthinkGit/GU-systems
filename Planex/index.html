<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://SamthinkGit.github.io/GU-systems/Planex/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Planex as an Approximation to $A_1$ - Execution Cognition Machine (ECM)</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Execution Cognition Machine (ECM)</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">ðŸŒŸ GU-Systems: ECM approximation to Computer Autonomous AI ðŸŒŸ</a>
                            </li>
                            <li class="nav-item">
                                <a href="../AgentProtocol/" class="nav-link">AgentProtocol</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Architecture-Guide/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Bibliography/" class="nav-link">Bibliography</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Cognition-Layer-API-%28Planex%29/" class="nav-link">Cognition Layer API</a>
                            </li>
                            <li class="nav-item">
                                <a href="../ECM-Problem-Analysis/" class="nav-link">ECM Problem Analysis</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Exelent/" class="nav-link">Exelent</a>
                            </li>
                            <li class="nav-item">
                                <a href="../FastAgentProtocol/" class="nav-link">FastAgentProtocol Documentation</a>
                            </li>
                            <li class="nav-item">
                                <a href="../FastReact/" class="nav-link">FastReact</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Home/" class="nav-link">ðŸŒŸ GU-Systems: ECM approximation to Computer Autonomous AI ðŸŒŸ</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Interpreter/" class="nav-link">Interpreter</a>
                            </li>
                            <li class="nav-item">
                                <a href="../ItemRegistry/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="../LLMs-and-State-of-Art/" class="nav-link">LLMs and State of Art</a>
                            </li>
                            <li class="nav-item">
                                <a href="../MouseAgent-Insights/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Planex-Insights/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Planex as an Approximation to $A_1$</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Pyxcel-Interpreter/" class="nav-link">Pyxcel Interpreter</a>
                            </li>
                            <li class="nav-item">
                                <a href="../ROSA-Interpreter/" class="nav-link">ROSA Interpreter</a>
                            </li>
                            <li class="nav-item">
                                <a href="../ROSA/" class="nav-link">Using ROSA (ROS Agent)</a>
                            </li>
                            <li class="nav-item">
                                <a href="../RePlan-Insights/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Remote-Execution/" class="nav-link">ECM Server/Client</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Rosa-Insights/" class="nav-link">Implementation of the Execution Layer Algorithm with ROSA ($A_2$)</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Self%E2%80%90Training-Agents/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="../SimpleCognitiveMemory/" class="nav-link">SimpleCognitiveMemory Documentation</a>
                            </li>
                            <li class="nav-item">
                                <a href="../System-Architecture-Overview/" class="nav-link">System Architecture Overview</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Theoretical-Fundamentals/" class="nav-link">Theoretical Fundamentals</a>
                            </li>
                            <li class="nav-item">
                                <a href="../What-is-GU/" class="nav-link">What is GU</a>
                            </li>
                            <li class="nav-item">
                                <a href="../Xplore-Insights/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="../_Footer/" class="nav-link"> Footer</a>
                            </li>
                            <li class="nav-item">
                                <a href="../_Sidebar/" class="nav-link"> Sidebar</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../Planex-Insights/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Pyxcel-Interpreter/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/SamthinkGIt/GU-systems/edit/master/docs/Planex.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#planex-as-an-approximation-to-a_1" class="nav-link">Planex as an Approximation to $A_1$</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#usage" class="nav-link">Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#merging-chains" class="nav-link">Merging Chains</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#planex-prompt-engineering" class="nav-link">Planex Prompt Engineering</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="planex-as-an-approximation-to-a_1">Planex as an Approximation to $A_1$</h1>
<p>Planex is a sophisticated <strong>3-step planner agent</strong> designed to approximate the ECM problem through the utilization of LangChain. This approximation involves the collaborative efforts of three distinct agents, each focusing on a crucial aspect of the process: Planning, Reduction, and Translation, as delineated in the <a href="https://github.com/SamthinkGit/GU-systems/wiki/ECM-Problem-Analysis">Theoretical Analysis</a>.</p>
<p>To provide a comprehensive understanding, these three steps correspond to the following concepts:
- <strong>Planning</strong>: The planning agent receives a natural language query from the user and devises a solution to approximate the problem. This process is independent of the specific context or tools available to the agents.
- <strong>Reduction</strong>: The reduction agent takes the explanation of the problem provided by the planner and identifies a set of tools that correspond to each instruction. Consequently, the resulting plan includes the necessary keywords and tools for execution.
- <strong>Translation</strong>: The translation agent receives the plan and generates an <a href="https://github.com/SamthinkGit/GU-systems/wiki/Exelent">Exelent</a> file, which can be executed to achieve the desired solution.</p>
<h2 id="usage">Usage</h2>
<p>To begin, let us explore the implementation of these agents. All agents within Planex are located in the <a href="https://github.com/SamthinkGit/GU-systems/tree/main/cognition_layer/planex/agents">/agents</a> directory. Each agent possesses an attribute <code>chain</code>, which contains the execution module of the chain. Additionally, each agent includes a function for direct execution with a query, as illustrated in the example below:</p>
<pre><code class="language-python">from cognition_layer.planex.agents.planner import Planner
from cognition_layer.planex.agents.reducer import Reducer
from cognition_layer.planex.agents.translator import Translator

planner = Planner()
reducer = Reducer()
translator = Translator()

# Execute an example action for each agent
planner_result = planner.plan(&quot;Open Spotify&quot;, verbose=True)
reducer_result = reducer.reduce(planner_result.content, verbose=True)
translator_result = translator.translate(translator.content, verbose=False)
print(&quot;Plan defined: &quot;, translator_result.content)
</code></pre>
<p>It is important to note that each agent returns a <a href="https://api.python.langchain.com/en/stable/messages/langchain_core.messages.base.BaseMessage.html">BaseMessage</a> from LangChain, ensuring both traceability and scalability. As a result, the output of the agents is contained in the .content attribute of the Messages.</p>
<p>Upon executing the above code, you may observe that the plan references functions not yet defined. This occurs because <strong>the agents have not been provided with the specific actions</strong> they can utilize to solve the plan. To define new actions, you can register your functions within the ItemRegistry, and they will be automatically integrated into the planners.</p>
<pre><code class="language-python">from ecm.tools.registry import ItemRegistry

@ItemRegistry.register_function
def click(place: str) -&gt; None:
    &quot;&quot;&quot;Clicks on the specified place&quot;&quot;&quot;
    print(&quot;Clicked on &quot;, place)

# If you instantiate the tool after initializing the agents, notify the reducer to update its actions:
reducer.auto_bind_actions()
</code></pre>
<blockquote>
<p>It is crucial that the <strong>docstring and typing</strong> are provided for the registered function, as this information is used by the agent to describe the function to the LLM.</p>
</blockquote>
<p>After registering the new actions, you can re-execute your three agents, and the defined actions will be considered when formulating the Exelent plan.</p>
<h2 id="merging-chains">Merging Chains</h2>
<p>As mentioned earlier, each agent contains a LangChain chain. This allows for the <strong>combination of all agents into a single entity</strong> by pipelining the necessary messages for each agent:</p>
<pre><code class="language-python">planex = (
    planner.chain
    | (lambda output: {&quot;input&quot;: output.content, &quot;actions&quot;: reducer.actions})
    | reducer.chain
    | (lambda output: {&quot;input&quot;: output.content})
    | translator.chain
)
</code></pre>
<p>You can now effortlessly execute Planex by invoking it as a chain:</p>
<pre><code class="language-python">result = planex.invoke({&quot;input&quot;: query})
print(&quot;Result: &quot;, result.content)
</code></pre>
<h2 id="planex-prompt-engineering">Planex Prompt Engineering</h2>
<p>The instructions defined for each agent in Planex can be found in the <a href="https://github.com/SamthinkGit/GU-systems/blob/main/cognition_layer/planex/agents/prompts.py">/agents/prompts.py</a> module. This module contains multiple prompts that are included in each invocation. Each prompt comprises specific instructions detailing the target, guidelines to be followed, and examples to illustrate proper usage. You are encouraged to modify these prompts to explore potential new behaviors and functionalities of Planex.</p>
<p>After defining the prompts in the prompts.py file, they are merged for each agent as follows:</p>
<pre><code class="language-python">sys_message = (
    &quot;\nInstructions: \n&quot;
    + PlanexPrompts.AGENT_INSTRUCTIONS
    + &quot;\nGuidelines: \n&quot;
    + PlanexPrompts.AGENT_GUIDELINES
    + &quot;\nExample:\n&quot;
    + PlanexPrompts.AGENT_EXAMPLE
)

# The agent here could be the planner, reducer, or translator 
agent.prompt = ChatPromptTemplate.from_messages(
    [(&quot;system&quot;, sys_message), (&quot;user&quot;, &quot;{input}&quot;)]
)
</code></pre>
<p>In this implementation, the sys_message variable is constructed by concatenating the instructions, guidelines, and example prompts defined in the PlanexPrompts class. This combined system message is then assigned to the prompt attribute of the respective agent (planner, reducer, or translator). The ChatPromptTemplate.from_messages method is used to create a prompt template from these system and user messages, facilitating effective communication and task execution by the agents.</p>
<p><strong>Feel free to experiment with</strong> and refine these prompts to optimize the performance and adaptability of Planex to various scenarios and requirements.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
